<div class="container">
  <h1>
    Analytic server information
  </h1>
  <p>
    <strong>Name:</strong>
    <%= @analytic_server.name %>
  </p>

  <p>
    <strong>IP:</strong>
    <%= @analytic_server.ip %>
  </p>

  <p>
    <strong>Port:</strong>
    <%= @analytic_server.port %>
  </p>

  <%
    status = ""
    pid = 0
    @analytic_server.status.blank? ? status = 'Unknown' : status = @analytic_server.status
    @analytic_server.pid.blank? ? pid = 0 : pid = @analytic_server.pid.to_i
  %>

  <p>
    <strong>Status:</strong>
    <%if status != 'Running' %>
        <b style="color:red;"><%= status %></b>
    <% else %>
        <b style="color:green;"><%= status %></b>
    <% end %>
  </p>

  <p>
    <strong>Process ID:</strong>
    <%if pid <= 0 %>
        <b style="color:red;"><%= pid %></b>
    <% else %>
        <b style="color:green;"><%= pid %></b>
    <% end %>
  </p>

  <div class="container">
    <%= link_to 'Analytic Server List', analytic_servers_path, class: 'btn btn-xs btn-default'%> |
    <!-- TODO Allow editing and destroying only if the analytic server is not running -->
    <%= link_to 'Edit', edit_analytic_server_path(@analytic_server), :class => "btn btn-xs btn-warning" %>
  </div>

  <div class="container">
    <p>
    <h2>
      Analytic instances
    </h2>
    </p>

    <%if @analytic_server.analytic_instances.empty?%>
        <div class="alert alert-warning">
          <center>
            Currently no analytic instances are assigned to this analytic server.
          </center>
        </div>
    <%else%>
        <div class="media">
          <table class="table table-hover">
            <thead>
            <tr>
              <th>#</th>
              <th>Analytic ID</th>
              <th>Name</th>
              <th>Type</th>
              <!--<th>PID</th>-->
              <th>Status</th>
              <th colspan="3"></th>
            </tr>
            </thead>

            <tbody>
            <% i = 1 %>
            <% @analytic_server.analytic_instances.each do |analytic_inst| %>
                <%
                  inst_status = nil
                  #inst_pid = 0
                  analytic_inst.status.blank? ? inst_status = 4 : inst_status = analytic_inst.status

                  analytic_inst_status = nil

                  if inst_status == 0
                    analytic_inst_status = 'Stopped'
                  elsif inst_status == 1
                    analytic_inst_status = 'Starting'
                  elsif inst_status == 2
                    analytic_inst_status = 'Running' #AKA Started
                  elsif inst_status == 3
                    analytic_inst_status = 'Error'
                  elsif inst_status == 4
                    analytic_inst_status = 'Unknown'
                  end


                %>
                <tr>
                  <td><%= i %></td>
                  <td><%= analytic_inst.id %></td>
                  <td><%= analytic_inst.name %></td>
                  <td><%= analytic_inst.analytic.name %></td>
                  <td>
                    <%if analytic_inst_status != 'Running' %>
                        <b style="color:red;"><%= analytic_inst_status %></b>
                    <% else %>
                        <b style="color:green;"><%= analytic_inst_status %></b>
                    <% end %>
                  </td>

                  <td><%= link_to 'Show', analytic_inst, :class => "btn btn-xs btn-default" %></td>
                  <td><%= link_to 'Edit', edit_analytic_instance_path(analytic_inst), :class => "btn btn-xs btn-warning" %></td>
                  <td><%= link_to 'Delete', analytic_inst, method: :delete, :class => "btn btn-xs btn-danger", data: { confirm: 'Are you sure?' } %></td>
                </tr>
                <% i = i + 1 %>
            <% end %>
            </tbody>
          </table>
        </div>
    <%end%>
  </div>
  <%# link_to 'Edit', edit_analytic_server_path(@analytic_server) %>
  <%#link_to 'Back', analytic_servers_path %>
</div>